"use strict";(self.webpackChunkiconic_taste_backend=self.webpackChunkiconic_taste_backend||[]).push([[3650],{58774:(Qe,M,a)=>{a.r(M),a.d(M,{default:()=>Be});var e=a(67294),j=a(15482),E=a(97132),u=a(68547),m=a(50779),Z=a(78384),S=a(78862),$=a(62031),P=a(19408),H=a(80768),O=a.n(H),F=a(5493),V=a(59522),W=a(19839),G=a(56219),J=a(71382),K=a(45687),A=a(23724),X=a(84686),Y=(n,t,s)=>new Promise((c,r)=>{var g=l=>{try{i(s.next(l))}catch(o){r(o)}},f=l=>{try{i(s.throw(l))}catch(o){r(o)}},i=l=>l.done?c(l.value):Promise.resolve(l.value).then(g,f);i((s=s.apply(n,t)).next())});const w=({skipWhen:n})=>{const{formatMessage:t}=(0,E.useIntl)(),s=(0,u.useNotification)(),{notifyStatus:c}=(0,X.useNotifyAT)(),[{rawQuery:r}]=(0,u.useQueryParams)(),g=(0,m.IF)("files"),f=()=>Y(void 0,null,function*(){const{data:v}=yield m.be.get(`${g}${r}`);return v}),{data:i,error:l,isLoading:o}=(0,A.useQuery)(["assets",r],f,{enabled:!n,staleTime:0,cacheTime:0});return(0,e.useEffect)(()=>{i&&c(t({id:"list.asset.at.finished",defaultMessage:"The assets have finished loading."}))},[i,c,t]),(0,e.useEffect)(()=>{l&&s({type:"warning",message:{id:"notification.error"}})},[l,s]),{data:i,error:l,isLoading:o}};var k=a(23980),q=a.n(k),_=a(99398),ee=a(32269),T=a(62082);const te=()=>{var n;const t=(0,e.useRef)(null),[s,c]=(0,e.useState)(!1),{formatMessage:r}=(0,E.useIntl)(),[{query:g},f]=(0,u.useQueryParams)(),i=((n=g==null?void 0:g.filters)==null?void 0:n.$and)||[],l=()=>c(y=>!y),o=y=>{f({filters:{$and:y},page:1})},v=y=>{f({filters:{$and:y},page:1})};return e.createElement(e.Fragment,null,e.createElement(P.Button,{variant:"tertiary",ref:t,startIcon:e.createElement(q(),null),onClick:l,size:"S"},r({id:"app.utils.filters",defaultMessage:"Filters"})),s&&e.createElement(ee.Z,{displayedFilters:T.Z,filters:i,onSubmit:v,onToggle:l,source:t}),e.createElement(_.Z,{appliedFilters:i,filtersSchema:T.Z,onRemoveFilter:o}))};var se=a(45697),p=a.n(se),ae=a(67826);const C=({pagination:n})=>e.createElement(F.Box,{paddingTop:6},e.createElement(ae.Flex,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(u.PageSizeURLQuery,null),e.createElement(u.PaginationURLQuery,{pagination:n})));C.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},C.propTypes={pagination:p().shape({page:p().number,pageCount:p().number,pageSize:p().number,total:p().number})};var ne=a(60269),le=a(49425),oe=a(9008),re=a(18568),ie=a.n(re),ce=a(45454),ue=Object.defineProperty,de=Object.defineProperties,me=Object.getOwnPropertyDescriptors,Q=Object.getOwnPropertySymbols,ge=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable,R=(n,t,s)=>t in n?ue(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,ve=(n,t)=>{for(var s in t||(t={}))ge.call(t,s)&&R(n,s,t[s]);if(Q)for(var s of Q(t))fe.call(t,s)&&R(n,s,t[s]);return n},pe=(n,t)=>de(n,me(t));const ye=n=>{const t=n.map(s=>(0,ce.H)(s));return Promise.all(t)},he=()=>{const n=(0,u.useNotification)(),t=(0,A.useQueryClient)(),s=(0,A.useMutation)(ye,{onSuccess:()=>{t.refetchQueries(["assets"],{active:!0}),t.refetchQueries(["asset-count"],{active:!0}),n({type:"success",message:{id:"modal.remove.success-label",defaultMessage:"The asset has been successfully removed."}})},onError:r=>{n({type:"warning",message:r.message})}}),c=r=>s.mutateAsync(r);return pe(ve({},s),{removeAssets:c})};var Ee=a(93593),Se=(n,t,s)=>new Promise((c,r)=>{var g=l=>{try{i(s.next(l))}catch(o){r(o)}},f=l=>{try{i(s.throw(l))}catch(o){r(o)}},i=l=>l.done?c(l.value):Promise.resolve(l.value).then(g,f);i((s=s.apply(n,t)).next())});const D=({selectedAssets:n,onSuccess:t})=>{const{formatMessage:s}=(0,E.useIntl)(),[c,r]=(0,e.useState)(!1),{isLoading:g,removeAssets:f}=he(),i=()=>Se(void 0,null,function*(){yield f(n.map(({id:l})=>l)),t()});return e.createElement(e.Fragment,null,e.createElement(oe.Stack,{horizontal:!0,spacing:2,paddingBottom:5},e.createElement(le.Typography,{variant:"epsilon",textColor:"neutral600"},s({id:(0,Ee.Z)("list.assets.selected"),defaultMessage:"{number, plural, =0 {No asset} one {1 asset} other {# assets}} selected"},{number:n.length})),e.createElement(P.Button,{variant:"danger-light",size:"S",startIcon:e.createElement(ie(),null),onClick:()=>r(!0)},s({id:"global.delete",defaultMessage:"Delete"}))),e.createElement(u.ConfirmDialog,{isConfirmButtonLoading:g,isOpen:c,onToggleDialog:()=>r(!1),onConfirm:i}))};D.propTypes={selectedAssets:p().arrayOf(p().shape({})).isRequired,onSuccess:p().func.isRequired};var Pe=a(54053);const Ae=(0,Z.default)(F.Box)`
  height: ${32/16}rem;
  display: flex;
  align-items: center;
`,Ce=()=>{var n;const{canRead:t,canCreate:s,canUpdate:c,canCopyLink:r,canDownload:g,isLoading:f}=(0,ne.y)(),[{query:i},l]=(0,u.useQueryParams)(),{formatMessage:o}=(0,E.useIntl)(),{data:v,isLoading:y,error:Le}=w({skipWhen:!t}),Me=L=>{l({sort:L})},[Oe,Fe]=(0,e.useState)(!1),[I,x]=(0,e.useState)(void 0),[h,{selectOne:Te,selectAll:U}]=(0,u.useSelectionState)("id",[]),B=()=>Fe(L=>!L);(0,u.useFocusWhenNavigate)();const b=f||y,d=v==null?void 0:v.results,N=((n=v==null?void 0:v.pagination)==null?void 0:n.total)||0,z=Boolean(i._q||i.filters);return e.createElement(S.Layout,null,e.createElement($.Main,{"aria-busy":b},e.createElement(S.HeaderLayout,{title:o({id:(0,m.OB)("plugin.name"),defaultMessage:"Media Library"}),subtitle:o({id:(0,m.OB)(N>0?"header.content.assets-multiple":"header.content.assets.assets-single"),defaultMessage:"0 assets"},{number:N}),primaryAction:s?e.createElement(P.Button,{startIcon:e.createElement(O(),null),onClick:B},o({id:(0,m.OB)("header.actions.add-assets"),defaultMessage:"Add new assets"})):void 0}),e.createElement(S.ActionLayout,{startActions:e.createElement(e.Fragment,null,c&&e.createElement(Ae,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200"},e.createElement(V.BaseCheckbox,{"aria-label":o({id:(0,m.OB)("bulk.select.label"),defaultMessage:"Select all assets"}),indeterminate:(d==null?void 0:d.length)>0&&h.length>0&&h.length!==(d==null?void 0:d.length),value:(d==null?void 0:d.length)>0&&h.length===(d==null?void 0:d.length),onChange:()=>U(d)})),t&&e.createElement(K.Z,{onChangeSort:Me}),t&&e.createElement(te,null)),endActions:e.createElement(u.SearchURLQuery,{label:o({id:(0,m.OB)("search.label"),defaultMessage:"Search for an asset"})})}),e.createElement(S.ContentLayout,null,h.length>0&&e.createElement(D,{selectedAssets:h,onSuccess:U}),b&&e.createElement(u.LoadingIndicatorPage,null),Le&&e.createElement(u.AnErrorOccurred,null),!t&&e.createElement(u.NoPermissions,null),t&&d&&d.length===0&&e.createElement(Pe.i,{action:s&&!z?e.createElement(P.Button,{variant:"secondary",startIcon:e.createElement(O(),null),onClick:B},o({id:(0,m.OB)("header.actions.add-assets"),defaultMessage:"Add new assets"})):void 0,content:o(z?{id:(0,m.OB)("list.assets-empty.title-withSearch"),defaultMessage:"There are no assets with the applied filters"}:s?{id:(0,m.OB)("list.assets.empty"),defaultMessage:"Upload your first assets..."}:{id:(0,m.OB)("list.assets.empty.no-permissions"),defaultMessage:"The asset list is empty"})}),t&&d&&d.length>0&&e.createElement(e.Fragment,null,e.createElement(J.l,{assets:d,onEditAsset:x,onSelectAsset:Te,selectedAssets:h}),(v==null?void 0:v.pagination)&&e.createElement(C,{pagination:v.pagination})))),Oe&&e.createElement(W.x,{onClose:B,trackedLocation:"upload"}),I&&e.createElement(G.s,{onClose:()=>x(void 0),asset:I,canUpdate:c,canCopyLink:r,canDownload:g,trackedLocation:"upload"}))},Be=()=>{const[{rawQuery:n},t]=(0,u.useQueryParams)(),{formatMessage:s}=(0,E.useIntl)(),c=s({id:(0,m.OB)("plugin.name"),defaultMessage:"Media Library"});return(0,e.useEffect)(()=>{n||t({sort:"updatedAt:DESC",page:1,pageSize:10})},[n,t]),n?e.createElement(e.Fragment,null,e.createElement(j.Helmet,{title:c}),e.createElement(Ce,null)):null}}}]);
