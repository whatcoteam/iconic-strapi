"use strict";(self.webpackChunkiconic_taste_backend=self.webpackChunkiconic_taste_backend||[]).push([[9460],{93084:(U,P,e)=>{e.r(P),e.d(P,{default:()=>ne});var t=e(53547),y=e(23724),M=e(97132),x=e(80831),l=e(68547),S=e(67422),B=e(80117),o=e(35395),c=e(64459),u=e(94117),A=e(9524),m=e(2632),b=e(33483),g=e(39272),p=e(22754),f=e.n(p),L=e(51725),n=e(42722);const $=[{intlLabel:{id:(0,n.OB)("EditForm.inputToggle.label.email"),defaultMessage:"One account per email address"},description:{id:(0,n.OB)("EditForm.inputToggle.description.email"),defaultMessage:"Disallow the user to create multiple accounts using the same email address with different authentication providers."},name:"unique_email",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,n.OB)("EditForm.inputToggle.label.sign-up"),defaultMessage:"Enable sign-ups"},description:{id:(0,n.OB)("EditForm.inputToggle.description.sign-up"),defaultMessage:"When disabled (OFF), the registration process is forbidden. No one can subscribe anymore no matter the used provider."},name:"allow_register",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,n.OB)("EditForm.inputToggle.label.email-reset-password"),defaultMessage:"Reset password page"},description:{id:(0,n.OB)("EditForm.inputToggle.description.email-reset-password"),defaultMessage:"URL of your application's reset password page."},placeholder:{id:(0,n.OB)("EditForm.inputToggle.placeholder.email-reset-password"),defaultMessage:"ex: https://youtfrontend.com/reset-password"},name:"email_reset_password",type:"text",size:{col:6,xs:12}},{intlLabel:{id:(0,n.OB)("EditForm.inputToggle.label.email-confirmation"),defaultMessage:"Enable email confirmation"},description:{id:(0,n.OB)("EditForm.inputToggle.description.email-confirmation"),defaultMessage:"When enabled (ON), new registered users receive a confirmation email."},name:"email_confirmation",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,n.OB)("EditForm.inputToggle.label.email-confirmation-redirection"),defaultMessage:"Redirection url"},description:{id:(0,n.OB)("EditForm.inputToggle.description.email-confirmation-redirection"),defaultMessage:"After you confirmed your email, choose where you will be redirected."},placeholder:{id:(0,n.OB)("EditForm.inputToggle.placeholder.email-reset-password"),defaultMessage:"ex: https://youtfrontend.com/reset-password"},name:"email_confirmation_redirection",type:"text",size:{col:6,xs:12}}];var F=e(63600);const N=new RegExp("(^$)|((.+:\\/\\/.*)(d*)\\/?(.*))"),Q=F.object().shape({email_confirmation_redirection:F.mixed().when("email_confirmation",{is:!0,then:F.string().matches(N).required(),otherwise:F.string().nullable()}),email_reset_password:F.string(l.translatedErrors.string).matches(N,l.translatedErrors.regex).nullable()});var X=(a,i,s)=>new Promise((T,E)=>{var R=r=>{try{v(s.next(r))}catch(h){E(h)}},C=r=>{try{v(s.throw(r))}catch(h){E(h)}},v=r=>r.done?T(r.value):Promise.resolve(r.value).then(R,C);v((s=s.apply(a,i)).next())});const V=()=>X(void 0,null,function*(){const{data:a}=yield n.be.get((0,n.Gc)("advanced"));return a}),Y=a=>n.be.put((0,n.Gc)("advanced"),a);var J=Object.defineProperty,k=Object.defineProperties,q=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,_=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable,z=(a,i,s)=>i in a?J(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s,D=(a,i)=>{for(var s in i||(i={}))_.call(i,s)&&z(a,s,i[s]);if(j)for(var s of j(i))ee.call(i,s)&&z(a,s,i[s]);return a},G=(a,i)=>k(a,q(i)),W=(a,i,s)=>new Promise((T,E)=>{var R=r=>{try{v(s.next(r))}catch(h){E(h)}},C=r=>{try{v(s.throw(r))}catch(h){E(h)}},v=r=>r.done?T(r.value):Promise.resolve(r.value).then(R,C);v((s=s.apply(a,i)).next())});const te=()=>t.createElement(l.CheckPagePermissions,{permissions:L.Z.readAdvancedSettings},t.createElement(ae,null)),ae=()=>{const{formatMessage:a}=(0,M.useIntl)(),i=(0,l.useNotification)(),{lockApp:s,unlockApp:T}=(0,l.useOverlayBlocker)(),{notifyStatus:E}=(0,S.useNotifyAT)(),R=(0,y.useQueryClient)();(0,l.useFocusWhenNavigate)();const C=(0,t.useMemo)(()=>({update:L.Z.updateAdvancedSettings}),[]),{isLoading:v,allowedActions:{canUpdate:r}}=(0,l.useRBAC)(C),{status:h,data:H}=(0,y.useQuery)("advanced",()=>V(),{onSuccess:()=>{E(a({id:(0,n.OB)("Form.advancedSettings.data.loaded"),defaultMessage:"Advanced settings data has been loaded"}))},onError:()=>{i({type:"warning",message:{id:(0,n.OB)("notification.error"),defaultMessage:"An error occured"}})}}),se=v||h!=="success",Z=(0,y.useMutation)(O=>Y(O),{onSuccess:()=>W(void 0,null,function*(){yield R.invalidateQueries("advanced"),i({type:"success",message:{id:(0,n.OB)("notification.success.saved"),defaultMessage:"Saved"}}),T()}),onError:()=>{i({type:"warning",message:{id:(0,n.OB)("notification.error"),defaultMessage:"An error occured"}}),T()},refetchActive:!0}),{isLoading:ie}=Z,oe=O=>W(void 0,null,function*(){s();const w=O.email_confirmation?O.email_confirmation_redirection:"";yield Z.mutateAsync(G(D({},O),{email_confirmation_redirection:w}))});return se?t.createElement(B.Main,{"aria-busy":"true"},t.createElement(l.SettingsPageTitle,{name:a({id:(0,n.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),t.createElement(o.HeaderLayout,{title:a({id:(0,n.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),t.createElement(o.ContentLayout,null,t.createElement(l.LoadingIndicatorPage,null))):t.createElement(B.Main,{"aria-busy":ie},t.createElement(l.SettingsPageTitle,{name:a({id:(0,n.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),t.createElement(x.Formik,{onSubmit:oe,initialValues:H.settings,validateOnChange:!1,validationSchema:Q,enableReinitialize:!0},({errors:O,values:w,handleChange:K,isSubmitting:re})=>t.createElement(l.Form,null,t.createElement(o.HeaderLayout,{title:a({id:(0,n.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"}),primaryAction:t.createElement(c.Button,{loading:re,type:"submit",disabled:!r,startIcon:t.createElement(f(),null),size:"L"},a({id:"global.save",defaultMessage:"Save"}))}),t.createElement(o.ContentLayout,null,t.createElement(u.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(A.Stack,{spacing:4},t.createElement(b.Typography,{variant:"delta",as:"h2"},a({id:"global.settings",defaultMessage:"Settings"})),t.createElement(g.Grid,{gap:6},t.createElement(g.GridItem,{col:6,s:12},t.createElement(m.Select,{label:a({id:(0,n.OB)("EditForm.inputSelect.label.role"),defaultMessage:"Default role for authenticated users"}),value:w.default_role,hint:a({id:(0,n.OB)("EditForm.inputSelect.description.role"),defaultMessage:"It will attach the new authenticated user to the selected role."}),onChange:d=>K({target:{name:"default_role",value:d}})},H.roles.map(d=>t.createElement(m.Option,{key:d.type,value:d.type},d.name)))),$.map(d=>{let I=w[d.name];return I||(I=d.type==="bool"?!1:""),t.createElement(g.GridItem,D({key:d.name},d.size),t.createElement(l.GenericInput,G(D({},d),{value:I,error:O[d.name],disabled:d.name==="email_confirmation_redirection"&&w.email_confirmation===!1,onChange:K})))}))))))))},ne=te},65772:(U,P,e)=>{e.d(P,{Z:()=>B});var t=e(9669),y=e.n(t),M=e(68547),x=e.n(M),l=(o,c,u)=>new Promise((A,m)=>{var b=f=>{try{p(u.next(f))}catch(L){m(L)}},g=f=>{try{p(u.throw(f))}catch(L){m(L)}},p=f=>f.done?A(f.value):Promise.resolve(f.value).then(b,g);p((u=u.apply(o,c)).next())});const S=y().create({baseURL:""});S.interceptors.request.use(o=>l(void 0,null,function*(){return o.headers={Authorization:`Bearer ${M.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},o}),o=>{Promise.reject(o)}),S.interceptors.response.use(o=>o,o=>{var c;throw((c=o.response)==null?void 0:c.status)===401&&(M.auth.clearAppStorage(),window.location.reload()),o});const B=S},42722:(U,P,e)=>{e.d(P,{be:()=>t.Z,YX:()=>x,Gc:()=>B,OB:()=>o.Z});var t=e(65772),y=e(96486);const x=c=>Object.keys(c).reduce((u,A)=>{const m=c[A].controllers,b=Object.keys(m).reduce((g,p)=>((0,y.isEmpty)(m[p])||(g[p]=m[p]),g),{});return(0,y.isEmpty)(b)||(u[A]={controllers:b}),u},{});var l=e(83086);const B=c=>`/${l.Z}/${c}`;var o=e(97961)}}]);
